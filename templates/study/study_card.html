{% extends 'base.html' %}

{% block title %}学習中 - {{ deck.name }} - SRS Flashcard App{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- 進捗バー -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
        <div class="flex justify-between items-center mb-2">
            <span class="text-sm text-gray-600">{{ deck.name }}</span>
            <span class="text-sm text-gray-600">{{ current_index }} / {{ total_cards }}</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-indigo-600 h-2 rounded-full transition-all duration-300"
                 style="width: {% widthratio current_index total_cards 100 %}%"></div>
        </div>
    </div>

    <!-- カード -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <!-- 表面 -->
        <div class="p-8 border-b">
            <p class="text-sm text-indigo-600 font-medium mb-2">表面</p>
            <div class="text-xl text-gray-800 whitespace-pre-wrap">{{ card.front }}</div>
            {% if card.front_image %}
            <div class="mt-4">
                <img src="{{ card.front_image.url }}" alt="表面画像" class="max-w-full rounded-lg">
            </div>
            {% endif %}
        </div>

        <!-- 裏面（答えを表示時のみ） -->
        {% if show_answer %}
        <div class="p-8 bg-green-50">
            <p class="text-sm text-green-600 font-medium mb-2">裏面</p>
            <div class="text-xl text-gray-800 whitespace-pre-wrap">{{ card.back }}</div>
            {% if card.back_image %}
            <div class="mt-4">
                <img src="{{ card.back_image.url }}" alt="裏面画像" class="max-w-full rounded-lg">
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- アクションボタン -->
    <div class="mt-6">
        {% if show_answer %}
        <!-- 評価ボタン -->
        <form method="post" action="{% url 'study:answer' deck.pk card.pk %}">
            {% csrf_token %}
            <div class="grid grid-cols-4 gap-2">
                <button type="submit" name="rating" value="1"
                        class="bg-red-500 hover:bg-red-600 text-white py-4 px-2 rounded-lg transition-colors">
                    <span class="block text-lg font-bold">もう一度</span>
                    <span class="block text-xs opacity-80">{{ intervals.1 }}</span>
                </button>
                <button type="submit" name="rating" value="2"
                        class="bg-orange-500 hover:bg-orange-600 text-white py-4 px-2 rounded-lg transition-colors">
                    <span class="block text-lg font-bold">難しい</span>
                    <span class="block text-xs opacity-80">{{ intervals.2 }}</span>
                </button>
                <button type="submit" name="rating" value="3"
                        class="bg-green-500 hover:bg-green-600 text-white py-4 px-2 rounded-lg transition-colors">
                    <span class="block text-lg font-bold">良い</span>
                    <span class="block text-xs opacity-80">{{ intervals.3 }}</span>
                </button>
                <button type="submit" name="rating" value="4"
                        class="bg-blue-500 hover:bg-blue-600 text-white py-4 px-2 rounded-lg transition-colors">
                    <span class="block text-lg font-bold">簡単</span>
                    <span class="block text-xs opacity-80">{{ intervals.4 }}</span>
                </button>
            </div>
        </form>
        {% else %}
        <!-- 答えを表示ボタン -->
        <a href="?show=answer"
           class="block w-full bg-indigo-600 hover:bg-indigo-700 text-white text-center py-4 rounded-lg text-lg font-semibold transition-colors">
            答えを表示
        </a>
        {% endif %}
    </div>

    <!-- キーボードショートカットのヒント -->
    <div class="mt-6 text-center text-sm text-gray-500">
        {% if show_answer %}
        <p>キーボードショートカット: 1=もう一度, 2=難しい, 3=良い, 4=簡単</p>
        {% else %}
        <p>スペースキーで答えを表示</p>
        {% endif %}
    </div>

    <!-- 中断リンク -->
    <div class="mt-4 text-center">
        <a href="{% url 'decks:deck_detail' deck.pk %}" class="text-gray-500 hover:text-gray-700">
            学習を中断
        </a>
    </div>
</div>

<!-- キーボードショートカット -->
<script>
document.addEventListener('keydown', function(e) {
    {% if show_answer %}
    // 評価ショートカット
    if (['1', '2', '3', '4'].includes(e.key)) {
        e.preventDefault();
        const form = document.querySelector('form');
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'rating';
        input.value = e.key;
        form.appendChild(input);
        form.submit();
    }
    {% else %}
    // スペースで答えを表示
    if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        window.location.href = '?show=answer';
    }
    {% endif %}
});
</script>
{% endblock %}
